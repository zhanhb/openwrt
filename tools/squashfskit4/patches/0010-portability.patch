--- a/squashfs-tools/xattr.c
+++ b/squashfs-tools/xattr.c
@@ -34,7 +34,9 @@
 #include <dirent.h>
 #include <string.h>
 #include <stdlib.h>
+#if defined(linux)
 #include <sys/xattr.h>
+#endif
 
 #include "squashfs_fs.h"
 #include "squashfs_swap.h"
@@ -113,6 +115,7 @@ static int get_prefix(struct xattr_list
 
 static int read_xattrs_from_system(char *filename, struct xattr_list **xattrs)
 {
+#if defined(linux)
 	ssize_t size, vsize;
 	char *xattr_names, *p;
 	int i;
@@ -222,6 +225,10 @@ failed:
 	free(xattr_list);
 	free(xattr_names);
 	return 0;
+#else
+	*xattrs = NULL;
+	return 0;
+#endif
 }
 
 
--- a/squashfs-tools/unsquashfs_xattr.c
+++ b/squashfs-tools/unsquashfs_xattr.c
@@ -24,9 +24,9 @@
 
 #include "unsquashfs.h"
 #include "xattr.h"
-
+#if defined(linux)
 #include <sys/xattr.h>
-
+#endif
 #define NOSPACE_MAX 10
 
 extern int root_process;
@@ -34,6 +34,7 @@ extern int user_xattrs;
 
 void write_xattr(char *pathname, unsigned int xattr)
 {
+#if defined(linux)
 	unsigned int count;
 	struct xattr_list *xattr_list;
 	int i;
@@ -136,4 +137,5 @@ void write_xattr(char *pathname, unsigne
 	}
 
 	free_xattr(xattr_list, count);
+#endif
 }
